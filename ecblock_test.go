// Copyright 2016 Factom Foundation
// Use of this source code is governed by the MIT
// license that can be found in the LICENSE file.

package factom_test

import (
	"testing"

	"encoding/json"
	"github.com/FactomProject/factom"
)

func TestGetECBlock(t *testing.T) {
	// Check for a missing blockHash
	_, err := factom.GetECBlock("baadbaadbaadbaadbaadbaadbaadbaadbaadbaadbaadbaadbaadbaadbaadbaad")
	if err == nil {
		t.Error("expected error for missing block")
	} else {
		t.Log("Missing Block Error:", err)
	}

	ecb, err := factom.GetECBlock("639995e66788ca01709a97684062b466fdce7b840b12861adbe39392f50f6bd3")
	if err != nil {
		t.Error(err)
	}
	t.Log(ecb)
}

func TestUnmarshalECBlock(t *testing.T) {
	js := []byte(`{"ecblock":{"header":{"bodyhash":"4e7aa42c563abf9c676973f932aa2338405618987ea6432907cfad7b6d7dcb01","prevheaderhash":"15b4224421019445ad86557b48ff8a7e4f657fe1f27e6cb26c7c4048e2693bb0","prevfullhash":"42c33248752fee31d2b84882f3a7723155dd228eb2824b1924ad69060b8e5943","dbheight":20000,"headerexpansionarea":"","objectcount":23,"bodysize":1666,"chainid":"000000000000000000000000000000000000000000000000000000000000000c","ecchainid":"000000000000000000000000000000000000000000000000000000000000000c"},"body":{"entries":[{"serverindexnumber":0},{"number":1},{"number":2},{"number":3},{"version":0,"millitime":"0152565bc9b3","entryhash":"f8804eb291e6b9db8b7834029d225313d1de230252d2beb54cf07e17f422b336","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"59348813169785ee16a2494dc922a2c60c275daa546a0a0670fb1779e7354f3853caeaf118b6b32ce34638134a89df7e0028947db806cb31bd9fac34c88fbf07"},{"version":0,"millitime":"0152565bc9ba","entryhash":"3e35d3271964b7bc25cf9212bcb204ab56f7138d5707be5883fb49d337f95742","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"0235b70221d75eea0b57d54df107425b2f9281c595093e2112e2e99c2fb9b31ea00e4595c9abfe932307b664398081e1329e2812f7e248a15e34e080e14dee0e"},{"version":0,"millitime":"0152565bca66","entryhash":"7714b21de2b8489994aa326a91507f429b124db43f03f77d7f48147b61dff787","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"67cb430bc6de873b1378caf619c508ce56298fb2ba842994b4f8e338ac92d88a82dc5ccccc478b71683c00a3b912439800ee81a1b59f6f713dd34a47f173a20a"},{"version":0,"millitime":"0152565bcaeb","entryhash":"599f02162fdf09706a07c6485149f607adc9b6aac6c87879e2fde76155347deb","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"6ddbda2929f0b6523923c1939b5969a83049dcf2380cadf166efe64cae526e5d7dfa2e6353674a9e806e6a949d613d545091abe64d433a6c366f7e1b40747400"},{"version":0,"millitime":"0152565bcaf2","entryhash":"7bdd0c04bfb347fa5d9002a258340f4a436e6191ef1aa4987249a42d08f8ce9a","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"5cafba67d608664e972f62c798e33e6255a692135d9af888f8e16292afd89ff771ab19561b31540e6ca2e49d5f9d70b54f2c11a690093e76e56ad523640b8f0c"},{"version":0,"millitime":"0152565bcaf8","entryhash":"9280fef8b0d68517e79036ae1b8d9eb9dd8a3822ec7e83c70904845abd47f57f","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"07973aefbe1df4171a3cefb03595742b13782dc1cf9e3c86be45e761119bba4622bbe724674cada73cbcc7fe86d5d95134380d3ff30d3125b29aea23d1ec580d"},{"version":0,"millitime":"0152565bcafe","entryhash":"04a9b508732fe72467068a3e1c04fa737e5daa941ee4379fa4c79fbda745a8d4","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"cf6fa0137d8e0a702a37ff0561e49d1dd8434224773475153036f20199c29af4c7315a32363d51577cfa7a612e4f5ef988b0b94627a3a371d392ad9b98a25b07"},{"version":0,"millitime":"0152565bcb00","entryhash":"076a68c3c880dd3940377fe9ab9cb402fc74d55f25bd98dcd804a5ac33cb5755","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"d833c32b4cc53bac10f02921033711b2f6286d55f9109df79abacf22dce0dd29c50db63db33e847142a4c72bd5ab4d33bc9c1571049a0d9c08bf86ea38975406"},{"version":0,"millitime":"0152565bcb06","entryhash":"a20ec1f96a9170fa7b0f3b8e562b44aba321a51c46c6b1e796171d8c1237c97d","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"1d035cde8c19f9d6682203ac40cc62d5f78ab554ea38e5f1526b9cae1fee3d0e1b33f699224e07e9bda1b24dd2eed108a6798c2c3ea6e4ca4da98365e1bf5203"},{"version":0,"millitime":"0152565bcbaf","entryhash":"dc8dd0a57e395a87acc5b74affc0f2b8b0e714a377eece7dfa36928a854da833","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"070120f32f2a57ed8a091cfdc4ceeaf85e90c39a57521f6f14fc3bbff1217ea40f75203dea90975c5b8aa667a34030d7431e15f71033194d8ea6a6b21836d605"},{"version":0,"millitime":"0152565bcd2b","entryhash":"fbfe0f0ef3cebdb955960ea33de07d35746626acf4dee04d290ed46d529f95f0","credits":1,"ecpubkey":"4bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7","sig":"11bf43c91974e26d0fd3c3fcac4a669b075ec111d173c12984d39be11729dd81c13c93b25bff7dc071f81fba7f14da02d23d8f86c9694991543b3e861cf5200f"},{"version":0,"millitime":"0152565f5ce8","entryhash":"15d941bf10eac69292c1b0f0c48258d8403fe09da1622b87981ef15239e2b626","credits":1,"ecpubkey":"17ef7a21d1a616d65e6b73f3c6a7ad5c49340a6c2592872020ec60767ff00d7d","sig":"dfb31475c2a72ce65e8e1c8fe85e5b2a8b9752b5b45ff570f87d10c3b71d3e1051528908a7087d4b25f470ec426bb246a3690e740c49bc360d4a9bbf7dad8b0a"},{"number":4},{"number":5},{"number":6},{"number":7},{"number":8},{"number":9},{"number":10}]},"headerhash":"639995e66788ca01709a97684062b466fdce7b840b12861adbe39392f50f6bd3","fullhash":"644d7d08cd2c7972179284f55a8554f327e1a414f36ec8e56be22c5ef05bfd3f"},"rawdata":"000000000000000000000000000000000000000000000000000000000000000c4e7aa42c563abf9c676973f932aa2338405618987ea6432907cfad7b6d7dcb0115b4224421019445ad86557b48ff8a7e4f657fe1f27e6cb26c7c4048e2693bb042c33248752fee31d2b84882f3a7723155dd228eb2824b1924ad69060b8e594300004e200000000000000000170000000000000682000001010102010303000152565bc9b3f8804eb291e6b9db8b7834029d225313d1de230252d2beb54cf07e17f422b336014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b759348813169785ee16a2494dc922a2c60c275daa546a0a0670fb1779e7354f3853caeaf118b6b32ce34638134a89df7e0028947db806cb31bd9fac34c88fbf0703000152565bc9ba3e35d3271964b7bc25cf9212bcb204ab56f7138d5707be5883fb49d337f95742014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b70235b70221d75eea0b57d54df107425b2f9281c595093e2112e2e99c2fb9b31ea00e4595c9abfe932307b664398081e1329e2812f7e248a15e34e080e14dee0e03000152565bca667714b21de2b8489994aa326a91507f429b124db43f03f77d7f48147b61dff787014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b767cb430bc6de873b1378caf619c508ce56298fb2ba842994b4f8e338ac92d88a82dc5ccccc478b71683c00a3b912439800ee81a1b59f6f713dd34a47f173a20a03000152565bcaeb599f02162fdf09706a07c6485149f607adc9b6aac6c87879e2fde76155347deb014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b76ddbda2929f0b6523923c1939b5969a83049dcf2380cadf166efe64cae526e5d7dfa2e6353674a9e806e6a949d613d545091abe64d433a6c366f7e1b4074740003000152565bcaf27bdd0c04bfb347fa5d9002a258340f4a436e6191ef1aa4987249a42d08f8ce9a014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b75cafba67d608664e972f62c798e33e6255a692135d9af888f8e16292afd89ff771ab19561b31540e6ca2e49d5f9d70b54f2c11a690093e76e56ad523640b8f0c03000152565bcaf89280fef8b0d68517e79036ae1b8d9eb9dd8a3822ec7e83c70904845abd47f57f014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b707973aefbe1df4171a3cefb03595742b13782dc1cf9e3c86be45e761119bba4622bbe724674cada73cbcc7fe86d5d95134380d3ff30d3125b29aea23d1ec580d03000152565bcafe04a9b508732fe72467068a3e1c04fa737e5daa941ee4379fa4c79fbda745a8d4014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7cf6fa0137d8e0a702a37ff0561e49d1dd8434224773475153036f20199c29af4c7315a32363d51577cfa7a612e4f5ef988b0b94627a3a371d392ad9b98a25b0703000152565bcb00076a68c3c880dd3940377fe9ab9cb402fc74d55f25bd98dcd804a5ac33cb5755014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7d833c32b4cc53bac10f02921033711b2f6286d55f9109df79abacf22dce0dd29c50db63db33e847142a4c72bd5ab4d33bc9c1571049a0d9c08bf86ea3897540603000152565bcb06a20ec1f96a9170fa7b0f3b8e562b44aba321a51c46c6b1e796171d8c1237c97d014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b71d035cde8c19f9d6682203ac40cc62d5f78ab554ea38e5f1526b9cae1fee3d0e1b33f699224e07e9bda1b24dd2eed108a6798c2c3ea6e4ca4da98365e1bf520303000152565bcbafdc8dd0a57e395a87acc5b74affc0f2b8b0e714a377eece7dfa36928a854da833014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b7070120f32f2a57ed8a091cfdc4ceeaf85e90c39a57521f6f14fc3bbff1217ea40f75203dea90975c5b8aa667a34030d7431e15f71033194d8ea6a6b21836d60503000152565bcd2bfbfe0f0ef3cebdb955960ea33de07d35746626acf4dee04d290ed46d529f95f0014bcbc1c5ab90e432bd407a51eaa513b4050eecda1fd42bbf6b7050a1d96f94b711bf43c91974e26d0fd3c3fcac4a669b075ec111d173c12984d39be11729dd81c13c93b25bff7dc071f81fba7f14da02d23d8f86c9694991543b3e861cf5200f03000152565f5ce815d941bf10eac69292c1b0f0c48258d8403fe09da1622b87981ef15239e2b6260117ef7a21d1a616d65e6b73f3c6a7ad5c49340a6c2592872020ec60767ff00d7ddfb31475c2a72ce65e8e1c8fe85e5b2a8b9752b5b45ff570f87d10c3b71d3e1051528908a7087d4b25f470ec426bb246a3690e740c49bc360d4a9bbf7dad8b0a010401050106010701080109010a"}`)

	wrap := new(struct {
		ECBlock factom.ECBlock `json:"ecblock"`
	})

	err := json.Unmarshal(js, wrap)
	if err != nil {
		t.Error(err)
	}
	t.Log(wrap.ECBlock.String())
}
